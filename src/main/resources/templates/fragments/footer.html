<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<th:block th:fragment="scripts">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Common Scripts -->
    <script th:src="@{/js/common.js}"></script>
</th:block>
<!-- Footer Fragment -->
<footer th:fragment="footer" id="footer" style="background: linear-gradient(135deg, var(--primary-green) 0%, var(--light-green) 100%); color: white; padding: 60px 0 30px;">
    <div class="container">
        <div class="row">
            <!-- Company Info -->
            <div class="col-lg-4 col-md-6 mb-4 mb-lg-0">
                <div class="footer-item">
                    <div class="company-brand">
                        <h3 class="fw-bold mb-3 d-flex align-items-center">
                            <i class="bi bi-book-half me-2"></i> Greenbook
                        </h3>
                        <p style="opacity: 0.9; line-height: 1.8;">
                            Thư viện Greenbook - Nơi tri thức hòa quyện với thiên nhiên. Đọc sách, yêu sách, bảo vệ môi trường.
                        </p>
                        <div class="social-links mt-4">
                            <a href="#" class="text-white me-3" style="font-size: 1.5rem; transition: all 0.3s;">
                                <i class="bi bi-facebook"></i>
                            </a>
                            <a href="#" class="text-white me-3" style="font-size: 1.5rem; transition: all 0.3s;">
                                <i class="bi bi-twitter"></i>
                            </a>
                            <a href="#" class="text-white me-3" style="font-size: 1.5rem; transition: all 0.3s;">
                                <i class="bi bi-instagram"></i>
                            </a>
                            <a href="#" class="text-white" style="font-size: 1.5rem; transition: all 0.3s;">
                                <i class="bi bi-youtube"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- About Us -->
            <div class="col-lg-2 col-md-6 mb-4 mb-lg-0">
                <div class="footer-menu">
                    <h5 class="fw-bold mb-3">Về chúng tôi</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a th:href="@{/about}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                <i class="bi bi-chevron-right me-2"></i>Giới thiệu
                            </a>
                        </li>
                        <li class="mb-2">
                            <a th:href="@{/blogs}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                <i class="bi bi-chevron-right me-2"></i>Bài viết
                            </a>
                        </li>
                        <li class="mb-2">
                            <a th:href="@{/contact}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                <i class="bi bi-chevron-right me-2"></i>Liên hệ
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Explore -->
            <div class="col-lg-2 col-md-6 mb-4 mb-lg-0">
                <div class="footer-menu">
                    <h5 class="fw-bold mb-3">Khám phá</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a th:href="@{/}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                <i class="bi bi-chevron-right me-2"></i>Trang chủ
                            </a>
                        </li>
                        <li class="mb-2">
                            <a th:href="@{/books}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                <i class="bi bi-chevron-right me-2"></i>Kho sách
                            </a>
                        </li>
                        <li class="mb-2">
                            <a th:href="@{/promotions}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                <i class="bi bi-chevron-right me-2"></i>Khuyến mãi
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Account -->
            <div class="col-lg-2 col-md-6 mb-4 mb-lg-0">
                <div class="footer-menu">
                    <h5 class="fw-bold mb-3">Tài khoản</h5>
                    <ul class="list-unstyled">
                        <!-- Khi CHƯA đăng nhập -->
                        <th:block th:if="${isLoggedIn == null || isLoggedIn == false}">
                            <li class="mb-2">
                                <a th:href="@{/login}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                    <i class="bi bi-chevron-right me-2"></i>Đăng nhập
                                </a>
                            </li>
                            <li class="mb-2">
                                <a th:href="@{/register}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                    <i class="bi bi-chevron-right me-2"></i>Đăng ký
                                </a>
                            </li>
                        </th:block>

                        <!-- Khi ĐÃ đăng nhập -->
                        <th:block th:if="${isLoggedIn != null && isLoggedIn == true}">
                            <li class="mb-2">
                                <a th:href="@{/customer/profile}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                    <i class="bi bi-chevron-right me-2"></i>Thông tin
                                </a>
                            </li>
                            <li class="mb-2">
                                <a th:href="@{/cart}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                    <i class="bi bi-chevron-right me-2"></i>Giỏ hàng
                                </a>
                            </li>
                            <li class="mb-2">
                                <a th:href="@{/customer/orders}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                    <i class="bi bi-chevron-right me-2"></i>Đơn hàng
                                </a>
                            </li>
                            <li class="mb-2">
                                <form th:action="@{/logout}" method="post" style="margin: 0; display: inline;">
                                    <button type="submit" class="text-white text-decoration-none border-0 bg-transparent p-0"
                                            style="opacity: 0.9; transition: all 0.3s; cursor: pointer;">
                                        <i class="bi bi-chevron-right me-2"></i>Đăng xuất
                                    </button>
                                </form>
                            </li>
                        </th:block>
                    </ul>
                </div>
            </div>

            <!-- Support -->
            <div class="col-lg-2 col-md-6">
                <div class="footer-menu">
                    <h5 class="fw-bold mb-3">Hỗ trợ</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="#" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                <i class="bi bi-chevron-right me-2"></i>Trung tâm trợ giúp
                            </a>
                        </li>
                        <li class="mb-2">
                            <a th:href="@{/contact}" class="text-white text-decoration-none" style="opacity: 0.9; transition: all 0.3s;">
                                <i class="bi bi-chevron-right me-2"></i>Liên hệ
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- Footer Bottom -->
<div th:fragment="footer-bottom" id="footer-bottom" style="background: var(--dark-text); color: white; padding: 20px 0;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                <p class="mb-0" style="opacity: 0.8;">
                    &copy; 2025 Greenbook Library. All rights reserved.
                </p>
            </div>
            <div class="col-md-6 text-center text-md-end">
                <a href="#" class="text-white text-decoration-none me-3" style="opacity: 0.8;">Chính sách bảo mật</a>
                <a href="#" class="text-white text-decoration-none" style="opacity: 0.8;">Điều khoản sử dụng</a>
            </div>
        </div>
    </div>
</div>

<!-- Scripts Fragment -->
<th:block th:fragment="scripts">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Prevent double logout submission - FIX CHÍNH
        let isLoggingOut = false;

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('form[action*="/logout"]').forEach(form => {
                form.addEventListener('submit', function(e) {
                    if (isLoggingOut) {
                        e.preventDefault();
                        return false;
                    }
                    isLoggingOut = true;

                    // Disable all logout buttons
                    document.querySelectorAll('form[action*="/logout"] button').forEach(btn => {
                        btn.disabled = true;
                        btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Đang đăng xuất...';
                    });
                });
            });
        });

        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Footer link hover effect
        document.querySelectorAll('.footer-menu a, .social-links a').forEach(link => {
            link.addEventListener('mouseenter', function() {
                this.style.opacity = '1';
                this.style.paddingLeft = '5px';
            });
            link.addEventListener('mouseleave', function() {
                this.style.opacity = '0.9';
                this.style.paddingLeft = '0';
            });
        });

        // Back to top button
        const backToTop = document.createElement('button');
        backToTop.innerHTML = '<i class="bi bi-arrow-up"></i>';
        backToTop.style.cssText = 'display: none; z-index: 1000; width: 50px; height: 50px; border-radius: 50%; box-shadow: 0 5px 15px rgba(0,0,0,0.3); background: #40916c; border: none; color: white; position: fixed; bottom: 20px; right: 20px;';
        document.body.appendChild(backToTop);

        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTop.style.display = 'block';
            } else {
                backToTop.style.display = 'none';
            }
        });

        backToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>

    <style>
        /* Footer link hover effect */
        .footer-menu a,
        .footer-menu button {
            display: inline-block;
        }

        .footer-menu button:hover {
            opacity: 1 !important;
            padding-left: 5px;
        }

        .social-links a:hover {
            transform: translateY(-3px);
            opacity: 1 !important;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #footer {
                padding: 40px 0 20px;
            }

            .footer-menu h5 {
                font-size: 1rem;
            }
        }
    </style>
</th:block>
</body>
</html>